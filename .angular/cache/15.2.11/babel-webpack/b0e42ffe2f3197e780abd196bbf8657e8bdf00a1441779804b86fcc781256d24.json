{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/fabia/Desktop/ProyectoAppRegis/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Preferences } from '@capacitor/preferences';\nimport { ApiService } from '../servicios/api.service';\nimport { Router } from '@angular/router';\nimport { AlertController } from '@ionic/angular';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../servicios/api.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"angularx-qrcode\";\nfunction HomePage_ng_container_3_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"h3\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const nota_r4 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(nota_r4.notaValor);\n  }\n}\nfunction HomePage_ng_container_3_ion_item_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\", 9);\n    i0.ɵɵelement(1, \"ion-icon\", 10);\n    i0.ɵɵtext(2, \" Asistencia registrada hoy \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction HomePage_ng_container_3_ion_button_30_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-button\", 11);\n    i0.ɵɵlistener(\"click\", function HomePage_ng_container_3_ion_button_30_Template_ion_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.eliminarInscripcion());\n    });\n    i0.ɵɵtext(1, \" Eliminar inscripci\\u00F3n actual \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction HomePage_ng_container_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"ion-card\")(2, \"h2\");\n    i0.ɵɵtext(3, \"Datos del alumno\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"h3\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"h3\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"h3\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"h3\");\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"h3\");\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"h2\");\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"h3\");\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"h3\");\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"h3\");\n    i0.ɵɵtext(21, \"Notas:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(22, HomePage_ng_container_3_div_22_Template, 3, 1, \"div\", 2);\n    i0.ɵɵtemplate(23, HomePage_ng_container_3_ion_item_23_Template, 3, 0, \"ion-item\", 3);\n    i0.ɵɵelementStart(24, \"div\")(25, \"ion-button\", 4);\n    i0.ɵɵlistener(\"click\", function HomePage_ng_container_3_Template_ion_button_click_25_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.cargarInscripcionAlumno());\n    });\n    i0.ɵɵtext(26);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(27, \"div\", 5)(28, \"ion-button\", 4);\n    i0.ɵɵlistener(\"click\", function HomePage_ng_container_3_Template_ion_button_click_28_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.irAInscripcion());\n    });\n    i0.ɵɵtext(29);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(30, HomePage_ng_container_3_ion_button_30_Template, 2, 0, \"ion-button\", 6);\n    i0.ɵɵelementStart(31, \"div\", 7);\n    i0.ɵɵelement(32, \"qrcode\", 8);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"Nombre: \", ctx_r0.alumno.nombreCompleto, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"RUT: \", ctx_r0.alumno.rut, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Correo: \", ctx_r0.alumno.correoElectronico, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Matr\\u00EDcula: \", ctx_r0.alumno.matricula, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Veh\\u00EDculo: \", ctx_r0.alumno.descripcionVehiculo, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Asignatura: \", ctx_r0.alumno.nombreAsignatura, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Profesor: \", ctx_r0.alumno.nombreProfesor, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Sala: \", ctx_r0.alumno.nombreSala, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.alumno.Notas);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.asistenciaRegistradaHoy);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.alumno.inscripcion ? \"Inscribir Asignatura\" : \"Inscribirse en Asignatura\", \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.alumno.nombreAsignatura ? \"Cambiar Asignatura\" : \"Inscribirse en Asignatura\", \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.inscripcionId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"qrdata\", ctx_r0.qrData)(\"width\", 200)(\"errorCorrectionLevel\", \"M\");\n  }\n}\nexport let HomePage = /*#__PURE__*/(() => {\n  class HomePage {\n    constructor(apiService, router, alertCtrl) {\n      this.apiService = apiService;\n      this.router = router;\n      this.alertCtrl = alertCtrl;\n      this.alumno = null;\n      this.qrData = '';\n      this.inscripcionId = null;\n      this.asistenciaRegistradaHoy = false;\n      this.notasAlumnos = [];\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const res = yield Preferences.get({\n          key: 'alumnoId'\n        });\n        const id = res.value;\n        if (id) {\n          _this.cargarDatosAlumno(+id);\n          _this.verificarAsistenciaHoy(+id);\n          _this.cargarInscripcionAlumno(+id);\n        }\n      })();\n    }\n    cargarDatosAlumno(id) {\n      this.apiService.getAlumnoCompleto(id).subscribe({\n        next: data => {\n          this.alumno = data;\n          this.apiService.cargarNotas(id).subscribe({\n            next: notas => {\n              this.alumno.Notas = notas;\n            },\n            error: err => {\n              console.error('No se pudo cargar las notas', err);\n            }\n          });\n          this.qrData = JSON.stringify({\n            id: data.id,\n            nombreCompleto: data.nombreCompleto,\n            rut: data.rut,\n            correo: data.correoElectronico,\n            asignatura: data.nombreAsignatura,\n            profesor: data.nombreProfesor,\n            sala: data.nombreSala,\n            asignaturaId: data.asignaturaId,\n            salaId: data.salaId,\n            alumnoId: data.id,\n            timestamp: new Date().toISOString()\n          });\n        },\n        error: err => {\n          console.error('Error al obtener datos completos del alumno', err);\n        }\n      });\n    }\n    cargarInscripcionAlumno(id) {\n      this.apiService.getInscripcionAlumno(id).subscribe({\n        next: inscripciones => {\n          this.inscripcionId = inscripciones[0]?.id || null;\n        },\n        error: err => {\n          console.error('No se pudo obtener inscripción del alumno', err);\n        }\n      });\n    }\n    cargarNotas(id) {\n      this.apiService.cargarNotas(id).subscribe({\n        next: notas => {\n          this.notasAlumnos = notas;\n        },\n        error: err => {\n          console.error('No se pudo cargar las notas', err);\n        }\n      });\n    }\n    verificarAsistenciaHoy(id) {\n      this.apiService.asistenciaRegistradaHoy(id).subscribe(res => {\n        this.asistenciaRegistradaHoy = res.registradaHoy;\n      }, err => {\n        console.error('Error al verificar asistencia de hoy', err);\n      });\n    }\n    irAInscripcion() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        if (_this2.alumno?.nombreAsignatura) {\n          const alert = yield _this2.alertCtrl.create({\n            header: 'Ya inscrito',\n            message: 'Ya estás inscrito en una asignatura. Si deseas cambiarla, primero debes eliminar la inscripción actual.',\n            buttons: ['OK']\n          });\n          yield alert.present();\n        } else {\n          _this2.router.navigate(['/inscripcion']);\n        }\n      })();\n    }\n    eliminarInscripcion() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this3.inscripcionId) return;\n        const confirm = yield _this3.alertCtrl.create({\n          header: '¿Eliminar inscripción?',\n          message: 'Esto eliminará tu asignatura, profesor y sala asignada.',\n          buttons: [{\n            text: 'Cancelar',\n            role: 'cancel'\n          }, {\n            text: 'Eliminar',\n            handler: () => {\n              _this3.apiService.eliminarInscripcion(_this3.inscripcionId).subscribe(() => {\n                location.reload(); // También puedes usar this.ngOnInit();\n              });\n            }\n          }]\n        });\n\n        yield confirm.present();\n      })();\n    }\n  }\n  HomePage.ɵfac = function HomePage_Factory(t) {\n    return new (t || HomePage)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.AlertController));\n  };\n  HomePage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: HomePage,\n    selectors: [[\"app-home\"]],\n    decls: 4,\n    vars: 1,\n    consts: [[1, \"ion-no-border\"], [4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [\"color\", \"success\", \"lines\", \"none\", \"class\", \"ion-margin-vertical\", 4, \"ngIf\"], [\"expand\", \"block\", \"shape\", \"round\", \"color\", \"primary\", 3, \"click\"], [2, \"text-align\", \"center\", \"margin-top\", \"16px\"], [\"expand\", \"block\", \"color\", \"danger\", 3, \"click\", 4, \"ngIf\"], [2, \"text-align\", \"center\", \"margin-top\", \"20px\"], [3, \"qrdata\", \"width\", \"errorCorrectionLevel\"], [\"color\", \"success\", \"lines\", \"none\", 1, \"ion-margin-vertical\"], [\"name\", \"checkmark-circle-outline\", \"slot\", \"start\"], [\"expand\", \"block\", \"color\", \"danger\", 3, \"click\"]],\n    template: function HomePage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\", 0);\n        i0.ɵɵelement(1, \"ion-toolbar\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(2, \"ion-content\");\n        i0.ɵɵtemplate(3, HomePage_ng_container_3_Template, 33, 16, \"ng-container\", 1);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.alumno);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf, i3.IonButton, i3.IonCard, i3.IonContent, i3.IonHeader, i3.IonIcon, i3.IonItem, i3.IonToolbar, i5.QRCodeComponent],\n    styles: [\"@charset \\\"UTF-8\\\";ion-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:16px;min-height:100%;--ion-background-color: transparent;background:linear-gradient(135deg,#6a11cb,#2575fc);background-attachment:fixed}ion-toolbar[_ngcontent-%COMP%]{--ion-background-color: transparent;opacity:0}ion-header[_ngcontent-%COMP%]{position:absolute;width:100%}ion-card[_ngcontent-%COMP%]{width:100%;max-width:500px;background:#ffffff;border-radius:20px;box-shadow:0 12px 30px #0003;padding:24px 20px;margin-bottom:20px;transition:transform .2s ease,box-shadow .2s ease}ion-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 16px 36px #00000040}ion-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:22px;font-weight:700;text-align:center;color:#1e2a38;margin-bottom:16px;letter-spacing:.5px}ion-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#3b3b3b;margin:8px 0;text-align:left;line-height:1.4}.notas[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}.notas[_ngcontent-%COMP%]   .nota[_ngcontent-%COMP%]{background:#f0f5ff;padding:8px 14px;border-radius:14px;font-weight:600;color:#1a3f7c;box-shadow:0 2px 6px #00000014;transition:transform .2s ease}.notas[_ngcontent-%COMP%]   .nota[_ngcontent-%COMP%]:hover{transform:scale(1.05)}ion-item[color=success][_ngcontent-%COMP%]{--background: #d1f7d6;--color: #2e7d32;border-radius:12px;font-weight:600;text-align:center}ion-button[_ngcontent-%COMP%]{margin-top:12px;font-weight:600;--border-radius: 14px;--box-shadow: 0 6px 12px rgba(0, 0, 0, .12);transition:transform .2s ease,box-shadow .2s ease}ion-button[_ngcontent-%COMP%]:hover{transform:translateY(-2px);--box-shadow: 0 8px 16px rgba(0, 0, 0, .15)}.qr-container[_ngcontent-%COMP%]{text-align:center;margin-top:24px}@media (min-width: 600px){ion-card[_ngcontent-%COMP%]{max-width:450px}}\"]\n  });\n  return HomePage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}