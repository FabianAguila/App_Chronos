{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/braya/Downloads/ChronosActualizado_modificado/ProyectoAppRegis/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ApiService } from '../servicios/api.service';\nimport { ToastController } from '@ionic/angular';\nimport { Preferences } from '@capacitor/preferences';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../servicios/api.service\";\nimport * as i2 from \"@ionic/angular\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@zxing/ngx-scanner\";\nfunction ScannerPage_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.…µ…µgetCurrentView();\n    i0.…µ…µelementContainerStart(0);\n    i0.…µ…µelementStart(1, \"zxing-scanner\", 3);\n    i0.…µ…µlistener(\"scanSuccess\", function ScannerPage_ng_container_5_Template_zxing_scanner_scanSuccess_1_listener($event) {\n      i0.…µ…µrestoreView(_r4);\n      const ctx_r3 = i0.…µ…µnextContext();\n      return i0.…µ…µresetView(ctx_r3.onCodeResult($event));\n    });\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementContainerEnd();\n  }\n  if (rf & 2) {\n    i0.…µ…µadvance(1);\n    i0.…µ…µproperty(\"torch\", true)(\"autostart\", true);\n  }\n}\nfunction ScannerPage_ng_template_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.…µ…µgetCurrentView();\n    i0.…µ…µelementStart(0, \"ion-text\", 4)(1, \"p\", 5);\n    i0.…µ…µtext(2, \" \\uD83D\\uDEAB No se detect\\u00F3 ninguna c\\u00E1mara.\");\n    i0.…µ…µelement(3, \"br\");\n    i0.…µ…µtext(4, \" Conecta una y presiona el bot\\u00F3n para volver a intentar. \");\n    i0.…µ…µelementEnd()();\n    i0.…µ…µelementStart(5, \"div\", 6)(6, \"ion-button\", 7);\n    i0.…µ…µlistener(\"click\", function ScannerPage_ng_template_6_Template_ion_button_click_6_listener() {\n      i0.…µ…µrestoreView(_r6);\n      const ctx_r5 = i0.…µ…µnextContext();\n      return i0.…µ…µresetView(ctx_r5.reintentarDeteccion());\n    });\n    i0.…µ…µtext(7, \" \\uD83D\\uDD04 Reintentar detecci\\u00F3n \");\n    i0.…µ…µelementEnd()();\n  }\n}\nexport let ScannerPage = /*#__PURE__*/(() => {\n  class ScannerPage {\n    constructor(apiService, toastCtrl) {\n      this.apiService = apiService;\n      this.toastCtrl = toastCtrl;\n      this.scannedResult = '';\n      this.hasCameras = true;\n      this.esAdmin = false;\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        yield _this.detectarCamara();\n        yield _this.verificarRol();\n      })();\n    }\n    verificarRol() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const {\n          value\n        } = yield Preferences.get({\n          key: 'nombreUsuario'\n        });\n        _this2.esAdmin = value?.toLowerCase().includes('admin') ?? false;\n      })();\n    }\n    detectarCamara() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const devices = yield navigator.mediaDevices.enumerateDevices();\n        const videoDevices = devices.filter(device => device.kind === 'videoinput');\n        _this3.hasCameras = videoDevices.length > 0;\n      })();\n    }\n    reintentarDeteccion() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        yield _this4.detectarCamara();\n        const toast = yield _this4.toastCtrl.create({\n          message: _this4.hasCameras ? 'üé• C√°mara detectada' : '‚ùå No se encontr√≥ c√°mara',\n          duration: 2000,\n          color: _this4.hasCameras ? 'success' : 'warning'\n        });\n        toast.present();\n      })();\n    }\n    onCodeResult(result) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        _this5.scannedResult = result;\n        try {\n          const qrData = JSON.parse(result);\n          if (!_this5.esAdmin) {\n            const toast = yield _this5.toastCtrl.create({\n              message: 'Solo los administradores pueden registrar asistencia',\n              duration: 2000,\n              color: 'warning'\n            });\n            toast.present();\n            return;\n          }\n          const payload = {\n            alumnoId: qrData.id,\n            asignaturaId: qrData.asignaturaId,\n            salaId: qrData.salaId\n          };\n          const nombreRes = yield Preferences.get({\n            key: 'nombreUsuario'\n          });\n          const nombreUsuario = nombreRes.value || '';\n          _this5.apiService.registrarAsistencia(payload, nombreUsuario).subscribe({\n            next: function () {\n              var _ref = _asyncToGenerator(function* () {\n                const toast = yield _this5.toastCtrl.create({\n                  message: '‚úÖ Asistencia registrada',\n                  duration: 2000,\n                  color: 'success'\n                });\n                toast.present();\n              });\n              return function next() {\n                return _ref.apply(this, arguments);\n              };\n            }(),\n            error: function () {\n              var _ref2 = _asyncToGenerator(function* () {\n                const toast = yield _this5.toastCtrl.create({\n                  message: '‚ùå Error al registrar asistencia',\n                  duration: 2000,\n                  color: 'danger'\n                });\n                toast.present();\n              });\n              return function error() {\n                return _ref2.apply(this, arguments);\n              };\n            }()\n          });\n        } catch {\n          const toast = yield _this5.toastCtrl.create({\n            message: '‚ö†Ô∏è QR inv√°lido',\n            duration: 2000,\n            color: 'warning'\n          });\n          toast.present();\n        }\n      })();\n    }\n  }\n  ScannerPage.…µfac = function ScannerPage_Factory(t) {\n    return new (t || ScannerPage)(i0.…µ…µdirectiveInject(i1.ApiService), i0.…µ…µdirectiveInject(i2.ToastController));\n  };\n  ScannerPage.…µcmp = /*@__PURE__*/i0.…µ…µdefineComponent({\n    type: ScannerPage,\n    selectors: [[\"app-scanner\"]],\n    decls: 8,\n    vars: 2,\n    consts: [[1, \"ion-padding\"], [4, \"ngIf\", \"ngIfElse\"], [\"noCam\", \"\"], [3, \"torch\", \"autostart\", \"scanSuccess\"], [\"color\", \"danger\"], [1, \"ion-text-center\"], [1, \"ion-text-center\", 2, \"margin-top\", \"1rem\"], [\"color\", \"primary\", 3, \"click\"]],\n    template: function ScannerPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.…µ…µelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-title\");\n        i0.…µ…µtext(3, \"Escanear QR\");\n        i0.…µ…µelementEnd()()();\n        i0.…µ…µelementStart(4, \"ion-content\", 0);\n        i0.…µ…µtemplate(5, ScannerPage_ng_container_5_Template, 2, 2, \"ng-container\", 1);\n        i0.…µ…µtemplate(6, ScannerPage_ng_template_6_Template, 8, 0, \"ng-template\", null, 2, i0.…µ…µtemplateRefExtractor);\n        i0.…µ…µelementEnd();\n      }\n      if (rf & 2) {\n        const _r1 = i0.…µ…µreference(7);\n        i0.…µ…µadvance(5);\n        i0.…µ…µproperty(\"ngIf\", ctx.hasCameras)(\"ngIfElse\", _r1);\n      }\n    },\n    dependencies: [i3.NgIf, i2.IonButton, i2.IonContent, i2.IonHeader, i2.IonText, i2.IonTitle, i2.IonToolbar, i4.ZXingScannerComponent],\n    styles: [\"zxing-scanner[_ngcontent-%COMP%]{display:block;width:100%;height:400px;margin:0 auto;border:2px solid #3b82f6;border-radius:10px}\"]\n  });\n  return ScannerPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}