{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/fabia/Documents/ChronosModificado/ProyectoAppRegis/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Router } from '@angular/router';\nimport { Preferences } from '@capacitor/preferences';\nimport { ApiService } from '../servicios/api.service';\nimport { ToastController } from '@ionic/angular';\nimport { take } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../servicios/api.service\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"@angular/common\";\nfunction TeacherChatPage_ion_item_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-item\", 2);\n    i0.ɵɵlistener(\"click\", function TeacherChatPage_ion_item_9_Template_ion_item_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r3);\n      const a_r1 = restoredCtx.$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.openConversation(a_r1));\n    });\n    i0.ɵɵelementStart(1, \"ion-avatar\", 4);\n    i0.ɵɵelement(2, \"img\", 5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ion-label\")(4, \"h3\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"ion-note\", 1);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const a_r1 = ctx.$implicit;\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(a_r1.nombre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(a_r1.mensaje);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(a_r1.hora);\n  }\n}\nexport let TeacherChatPage = /*#__PURE__*/(() => {\n  class TeacherChatPage {\n    constructor(router, api, toastCtrl) {\n      this.router = router;\n      this.api = api;\n      this.toastCtrl = toastCtrl;\n      this.alumnos = [];\n      this.profesorId = null;\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const {\n          value\n        } = yield Preferences.get({\n          key: 'profesorId'\n        });\n        _this.profesorId = value ? Number(value) : null;\n        // Intentamos cargar los alumnos reales del profesor\n        if (_this.profesorId) {\n          _this.api.getAlumnosProfesor(_this.profesorId).pipe(take(1)).subscribe({\n            next: lista => {\n              _this.alumnos = lista.map(a => ({\n                id: a.id,\n                nombre: a.nombreCompleto ?? a.nombre ?? `${a.nombres} ${a.apellidos}`,\n                mensaje: a.ultimoMensaje ?? '',\n                hora: a.ultimaHora ?? ''\n              }));\n            },\n            error: function () {\n              var _ref = _asyncToGenerator(function* (err) {\n                console.warn('No se pudo obtener alumnos por profesor, intentando cargar todos los alumnos', err);\n                // Fallback: cargar todos los alumnos registrados\n                _this.api.getAlumnos().pipe(take(1)).subscribe({\n                  next: all => {\n                    _this.alumnos = all.map(a => ({\n                      id: a.id,\n                      nombre: a.nombreCompleto ?? a.nombre ?? `${a.nombres} ${a.apellidos}`,\n                      mensaje: '',\n                      hora: ''\n                    }));\n                  },\n                  error: function () {\n                    var _ref2 = _asyncToGenerator(function* (err2) {\n                      console.error('No se pudo cargar lista de alumnos', err2);\n                      const t = yield _this.toastCtrl.create({\n                        message: 'No se pudo cargar la lista de alumnos.',\n                        duration: 2000\n                      });\n                      yield t.present();\n                      // Mantener lista vacía\n                    });\n                    return function error(_x2) {\n                      return _ref2.apply(this, arguments);\n                    };\n                  }()\n                });\n              });\n              return function error(_x) {\n                return _ref.apply(this, arguments);\n              };\n            }()\n          });\n        } else {\n          // Si no hay profesorId, dejar lista vacía y mostrar mensaje en UI\n          _this.alumnos = [];\n        }\n      })();\n    }\n    openConversation(alumno) {\n      // Navega a chat-room pasando el alumnoId; `chat-room` interpreta el id según rol\n      this.router.navigate(['/chat-room', alumno.id]);\n    }\n    // Cargar todos los alumnos registrados (para agregar a la lista del profesor)\n    mostrarTodos() {\n      var _this2 = this;\n      this.api.getAlumnos().pipe(take(1)).subscribe({\n        next: all => {\n          this.alumnos = all.map(a => ({\n            id: a.id,\n            nombre: a.nombreCompleto ?? a.nombre ?? `${a.nombres} ${a.apellidos}`,\n            mensaje: '',\n            hora: ''\n          }));\n        },\n        error: function () {\n          var _ref3 = _asyncToGenerator(function* (err) {\n            console.error('Error cargando todos los alumnos', err);\n            const t = yield _this2.toastCtrl.create({\n              message: 'No se pudo cargar los alumnos registrados.',\n              duration: 2000\n            });\n            yield t.present();\n          });\n          return function error(_x3) {\n            return _ref3.apply(this, arguments);\n          };\n        }()\n      });\n    }\n  }\n  TeacherChatPage.ɵfac = function TeacherChatPage_Factory(t) {\n    return new (t || TeacherChatPage)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.ToastController));\n  };\n  TeacherChatPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: TeacherChatPage,\n    selectors: [[\"app-teacher-chat\"]],\n    decls: 10,\n    vars: 1,\n    consts: [[1, \"ion-no-border\"], [\"slot\", \"end\"], [3, \"click\"], [3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"slot\", \"start\"], [\"src\", \"assets/images/avatar-default.png\"]],\n    template: function TeacherChatPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\", 0)(1, \"ion-toolbar\")(2, \"ion-title\");\n        i0.ɵɵtext(3, \"Chat Profesor\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"ion-buttons\", 1)(5, \"ion-button\", 2);\n        i0.ɵɵlistener(\"click\", function TeacherChatPage_Template_ion_button_click_5_listener() {\n          return ctx.mostrarTodos();\n        });\n        i0.ɵɵtext(6, \"Agregar\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(7, \"ion-content\")(8, \"ion-list\");\n        i0.ɵɵtemplate(9, TeacherChatPage_ion_item_9_Template, 10, 3, \"ion-item\", 3);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngForOf\", ctx.alumnos);\n      }\n    },\n    dependencies: [i4.NgForOf, i3.IonAvatar, i3.IonButton, i3.IonButtons, i3.IonContent, i3.IonHeader, i3.IonItem, i3.IonLabel, i3.IonList, i3.IonNote, i3.IonTitle, i3.IonToolbar],\n    styles: [\"[_nghost-%COMP%]{display:block}\"]\n  });\n  return TeacherChatPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}