{"ast":null,"code":"import _asyncToGenerator from \"E:/Git_Chronos/App_Chronos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { Router } from '@angular/router';\nimport { Preferences } from '@capacitor/preferences';\nimport { ApiService } from '../servicios/api.service';\nimport { AlertController, LoadingController } from '@ionic/angular';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../servicios/api.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@ionic/angular\";\nfunction ProfilePage_div_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28);\n    i0.ɵɵelement(1, \"ion-icon\", 29);\n    i0.ɵɵelementStart(2, \"span\");\n    i0.ɵɵtext(3, \"El nombre debe tener al menos 3 caracteres\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ProfilePage_div_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28);\n    i0.ɵɵelement(1, \"ion-icon\", 29);\n    i0.ɵɵelementStart(2, \"span\");\n    i0.ɵɵtext(3, \"Ingresa un email v\\u00E1lido\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let ProfilePage = /*#__PURE__*/(() => {\n  class ProfilePage {\n    constructor(fb, apiService, router, alertCtrl, loadingCtrl) {\n      this.fb = fb;\n      this.apiService = apiService;\n      this.router = router;\n      this.alertCtrl = alertCtrl;\n      this.loadingCtrl = loadingCtrl;\n      this.alumno = null;\n      this.loading = false;\n      this.profileForm = this.fb.group({\n        nombreCompleto: ['', [Validators.required, Validators.minLength(3)]],\n        email: ['', [Validators.required, Validators.email]],\n        comuna: ['', Validators.required],\n        rut: [{\n          value: '',\n          disabled: true\n        }],\n        id: [{\n          value: '',\n          disabled: true\n        }]\n      });\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        yield _this.loadUserData();\n      })();\n    }\n    loadUserData() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const res = yield Preferences.get({\n            key: 'alumnoId'\n          });\n          if (res.value) {\n            const alumnoId = parseInt(res.value, 10);\n            _this2.apiService.getAlumno(alumnoId).subscribe({\n              next: data => {\n                _this2.alumno = data;\n                _this2.profileForm.patchValue({\n                  nombreCompleto: data.nombreCompleto || '',\n                  email: data.email || '',\n                  comuna: data.comuna || '',\n                  rut: data.rut || '',\n                  id: data.id || ''\n                });\n              },\n              error: err => {\n                console.error('Error loading user data:', err);\n                _this2.showAlert('Error', 'No se pudo cargar la información del perfil');\n              }\n            });\n          }\n        } catch (error) {\n          console.error('Error reading preferences:', error);\n        }\n      })();\n    }\n    saveProfile() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        if (_this3.profileForm.invalid) {\n          _this3.showAlert('Error', 'Por favor completa todos los campos correctamente');\n          return;\n        }\n        const loading = yield _this3.loadingCtrl.create({\n          message: 'Guardando cambios...'\n        });\n        yield loading.present();\n        try {\n          const updatedData = {\n            ..._this3.alumno,\n            nombreCompleto: _this3.profileForm.value.nombreCompleto,\n            email: _this3.profileForm.value.email,\n            comuna: _this3.profileForm.value.comuna\n          };\n          _this3.apiService.updateAlumno(_this3.alumno.id, updatedData).subscribe({\n            next: function () {\n              var _ref = _asyncToGenerator(function* () {\n                yield loading.dismiss();\n                _this3.showAlert('Éxito', 'Perfil actualizado correctamente');\n                _this3.alumno = updatedData;\n              });\n              return function next() {\n                return _ref.apply(this, arguments);\n              };\n            }(),\n            error: function () {\n              var _ref2 = _asyncToGenerator(function* (err) {\n                yield loading.dismiss();\n                console.error('Error updating profile:', err);\n                _this3.showAlert('Error', 'No se pudo actualizar el perfil');\n              });\n              return function error(_x) {\n                return _ref2.apply(this, arguments);\n              };\n            }()\n          });\n        } catch (error) {\n          yield loading.dismiss();\n          console.error('Error:', error);\n          _this3.showAlert('Error', 'Ocurrió un error inesperado');\n        }\n      })();\n    }\n    cerrarSesion() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        const alert = yield _this4.alertCtrl.create({\n          header: 'Cerrar Sesión',\n          message: '¿Estás seguro de que deseas cerrar sesión?',\n          buttons: [{\n            text: 'Cancelar',\n            role: 'cancel'\n          }, {\n            text: 'Cerrar Sesión',\n            role: 'destructive',\n            handler: function () {\n              var _ref3 = _asyncToGenerator(function* () {\n                yield Preferences.remove({\n                  key: 'alumnoId'\n                });\n                yield Preferences.remove({\n                  key: 'isLoggedIn'\n                });\n                _this4.router.navigate(['/login']);\n              });\n              return function handler() {\n                return _ref3.apply(this, arguments);\n              };\n            }()\n          }]\n        });\n        yield alert.present();\n      })();\n    }\n    showAlert(header, message) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        const alert = yield _this5.alertCtrl.create({\n          header,\n          message,\n          buttons: ['OK']\n        });\n        yield alert.present();\n      })();\n    }\n    goBack() {\n      this.router.navigate(['/home']);\n    }\n  }\n  ProfilePage.ɵfac = function ProfilePage_Factory(t) {\n    return new (t || ProfilePage)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.AlertController), i0.ɵɵdirectiveInject(i4.LoadingController));\n  };\n  ProfilePage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ProfilePage,\n    selectors: [[\"app-profile\"]],\n    decls: 56,\n    vars: 5,\n    consts: [[1, \"ion-no-border\"], [\"slot\", \"start\"], [3, \"click\"], [\"name\", \"arrow-back\", \"slot\", \"icon-only\"], [1, \"profile-content\"], [1, \"profile-container\"], [1, \"avatar-section\"], [1, \"profile-avatar\"], [\"src\", \"assets/images/avatar-default.png\", \"alt\", \"Avatar\"], [1, \"profile-name\"], [1, \"profile-subtitle\"], [1, \"profile-form\", 3, \"formGroup\"], [1, \"info-card\"], [1, \"card-title\"], [1, \"form-field\"], [1, \"field-label\"], [\"lines\", \"none\", 1, \"custom-input\"], [\"formControlName\", \"nombreCompleto\", \"type\", \"text\", \"placeholder\", \"Ingresa tu nombre completo\"], [\"class\", \"error-message\", 4, \"ngIf\"], [\"formControlName\", \"email\", \"type\", \"email\", \"placeholder\", \"correo@ejemplo.com\"], [\"formControlName\", \"comuna\", \"type\", \"text\", \"placeholder\", \"Tu comuna\"], [\"lines\", \"none\", 1, \"custom-input\", \"readonly\"], [\"formControlName\", \"rut\", \"type\", \"text\", \"readonly\", \"\"], [\"formControlName\", \"id\", \"type\", \"text\", \"readonly\", \"\"], [\"expand\", \"block\", 1, \"save-btn\", 3, \"disabled\", \"click\"], [\"name\", \"save-outline\", \"slot\", \"start\"], [\"expand\", \"block\", \"fill\", \"outline\", \"color\", \"danger\", 1, \"logout-btn\", 3, \"click\"], [\"name\", \"log-out-outline\", \"slot\", \"start\"], [1, \"error-message\"], [\"name\", \"alert-circle-outline\"]],\n    template: function ProfilePage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\", 0)(1, \"ion-toolbar\")(2, \"ion-buttons\", 1)(3, \"ion-button\", 2);\n        i0.ɵɵlistener(\"click\", function ProfilePage_Template_ion_button_click_3_listener() {\n          return ctx.goBack();\n        });\n        i0.ɵɵelement(4, \"ion-icon\", 3);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"ion-title\");\n        i0.ɵɵtext(6, \"Perfil\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(7, \"ion-content\", 4)(8, \"div\", 5)(9, \"div\", 6)(10, \"ion-avatar\", 7);\n        i0.ɵɵelement(11, \"img\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"h2\", 9);\n        i0.ɵɵtext(13);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"p\", 10);\n        i0.ɵɵtext(15, \"Estudiante\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(16, \"form\", 11)(17, \"div\", 12)(18, \"h3\", 13);\n        i0.ɵɵtext(19, \"Informaci\\u00F3n Personal\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"div\", 14)(21, \"label\", 15);\n        i0.ɵɵtext(22, \"Nombre Completo\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"ion-item\", 16);\n        i0.ɵɵelement(24, \"ion-input\", 17);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(25, ProfilePage_div_25_Template, 4, 0, \"div\", 18);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(26, \"div\", 14)(27, \"label\", 15);\n        i0.ɵɵtext(28, \"Email\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(29, \"ion-item\", 16);\n        i0.ɵɵelement(30, \"ion-input\", 19);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(31, ProfilePage_div_31_Template, 4, 0, \"div\", 18);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"div\", 14)(33, \"label\", 15);\n        i0.ɵɵtext(34, \"Comuna\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(35, \"ion-item\", 16);\n        i0.ɵɵelement(36, \"ion-input\", 20);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(37, \"div\", 12)(38, \"h3\", 13);\n        i0.ɵɵtext(39, \"Informaci\\u00F3n de Cuenta\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(40, \"div\", 14)(41, \"label\", 15);\n        i0.ɵɵtext(42, \"RUT\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(43, \"ion-item\", 21);\n        i0.ɵɵelement(44, \"ion-input\", 22);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(45, \"div\", 14)(46, \"label\", 15);\n        i0.ɵɵtext(47, \"ID de Usuario\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(48, \"ion-item\", 21);\n        i0.ɵɵelement(49, \"ion-input\", 23);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(50, \"ion-button\", 24);\n        i0.ɵɵlistener(\"click\", function ProfilePage_Template_ion_button_click_50_listener() {\n          return ctx.saveProfile();\n        });\n        i0.ɵɵelement(51, \"ion-icon\", 25);\n        i0.ɵɵtext(52, \" Guardar Cambios \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(53, \"ion-button\", 26);\n        i0.ɵɵlistener(\"click\", function ProfilePage_Template_ion_button_click_53_listener() {\n          return ctx.cerrarSesion();\n        });\n        i0.ɵɵelement(54, \"ion-icon\", 27);\n        i0.ɵɵtext(55, \" Cerrar Sesi\\u00F3n \");\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        let tmp_2_0;\n        let tmp_3_0;\n        i0.ɵɵadvance(13);\n        i0.ɵɵtextInterpolate((ctx.alumno == null ? null : ctx.alumno.nombreCompleto) || \"Usuario\");\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"formGroup\", ctx.profileForm);\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngIf\", ((tmp_2_0 = ctx.profileForm.get(\"nombreCompleto\")) == null ? null : tmp_2_0.invalid) && ((tmp_2_0 = ctx.profileForm.get(\"nombreCompleto\")) == null ? null : tmp_2_0.touched));\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", ((tmp_3_0 = ctx.profileForm.get(\"email\")) == null ? null : tmp_3_0.invalid) && ((tmp_3_0 = ctx.profileForm.get(\"email\")) == null ? null : tmp_3_0.touched));\n        i0.ɵɵadvance(19);\n        i0.ɵɵproperty(\"disabled\", ctx.profileForm.invalid || ctx.loading);\n      }\n    },\n    styles: [\".profile-content[_ngcontent-%COMP%]{--background: $bg-app}.profile-container[_ngcontent-%COMP%]{padding:20px;max-width:600px;margin:0 auto}.avatar-section[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px;padding:30px 20px;background:#FFFFFF;border-radius:24px;box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f}.avatar-section[_ngcontent-%COMP%]   .profile-avatar[_ngcontent-%COMP%]{width:100px;height:100px;margin:0 auto 15px;border:3px solid #2563EB}.avatar-section[_ngcontent-%COMP%]   .profile-name[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#1f2937;margin:0 0 5px}.avatar-section[_ngcontent-%COMP%]   .profile-subtitle[_ngcontent-%COMP%]{font-size:14px;color:#6b7280;margin:0}.info-card[_ngcontent-%COMP%]{background:#FFFFFF;border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f}.info-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#1f2937;margin:0 0 20px;padding-bottom:10px;border-bottom:2px solid #DBEAFE}.form-field[_ngcontent-%COMP%]{margin-bottom:20px}.form-field[_ngcontent-%COMP%]   .field-label[_ngcontent-%COMP%]{display:block;font-size:13px;font-weight:600;color:#6b7280;margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px}.form-field[_ngcontent-%COMP%]   .custom-input[_ngcontent-%COMP%]{--background: #F9FAFB;--border-radius: 8px;--padding-start: 16px;--padding-end: 16px;border:1px solid #D1D5DB;border-radius:8px;margin-bottom:5px}.form-field[_ngcontent-%COMP%]   .custom-input.readonly[_ngcontent-%COMP%]{--background: #F3F4F6;opacity:.7}.form-field[_ngcontent-%COMP%]   .custom-input[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--color: #1F2937;--placeholder-color: #6B7280;font-size:15px}.form-field[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;color:#ef4444;font-size:12px;margin-top:5px}.form-field[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.save-btn[_ngcontent-%COMP%]{--background: #2563EB;--background-hover: #1D4ED8;--color: #FFFFFF;--border-radius: 8px;height:50px;font-size:16px;font-weight:600;margin-top:10px;margin-bottom:15px;text-transform:none}.save-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.logout-btn[_ngcontent-%COMP%]{--border-color: #EF4444;--color: #EF4444;--border-radius: 8px;--border-width: 2px;height:50px;font-size:16px;font-weight:600;text-transform:none}.logout-btn[_ngcontent-%COMP%]:hover{--background: rgba(239, 68, 68, .1)}.logout-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #2563EB;--color: #FFFFFF}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-weight:700;font-size:18px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--color: #FFFFFF}\"]\n  });\n  return ProfilePage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}