{"ast":null,"code":"import _asyncToGenerator from \"E:/Git_Chronos/App_Chronos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Router } from '@angular/router';\nimport { Preferences } from '@capacitor/preferences';\nimport { ApiService } from '../servicios/api.service';\nimport { ToastController } from '@ionic/angular';\nimport { take } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../servicios/api.service\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"@angular/common\";\nfunction TeacherChatPage_ion_item_13_ion_badge_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-badge\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const a_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(a_r1.unread);\n  }\n}\nfunction TeacherChatPage_ion_item_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-item\", 10);\n    i0.ɵɵlistener(\"click\", function TeacherChatPage_ion_item_13_Template_ion_item_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const a_r1 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.openConversation(a_r1));\n    });\n    i0.ɵɵelementStart(1, \"ion-avatar\", 11);\n    i0.ɵɵelement(2, \"img\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ion-label\", 13)(4, \"h3\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 14);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 15)(9, \"ion-note\", 16);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(11, TeacherChatPage_ion_item_13_ion_badge_11_Template, 2, 1, \"ion-badge\", 17);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const a_r1 = ctx.$implicit;\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(a_r1.nombre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(a_r1.mensaje || \"Sin mensajes todav\\u00EDa\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(a_r1.hora || \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", a_r1.unread);\n  }\n}\nexport let TeacherChatPage = /*#__PURE__*/(() => {\n  class TeacherChatPage {\n    constructor(router, api, toastCtrl) {\n      this.router = router;\n      this.api = api;\n      this.toastCtrl = toastCtrl;\n      this.alumnos = [];\n      this.profesorId = null;\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const {\n          value\n        } = yield Preferences.get({\n          key: 'profesorId'\n        });\n        _this.profesorId = value ? Number(value) : null;\n        // Intentamos cargar los alumnos reales del profesor\n        if (_this.profesorId) {\n          _this.api.getAlumnosProfesor(_this.profesorId).pipe(take(1)).subscribe({\n            next: lista => {\n              _this.alumnos = lista.map(a => ({\n                id: a.id,\n                nombre: a.nombreCompleto ?? a.nombre ?? `${a.nombres} ${a.apellidos}`,\n                mensaje: a.ultimoMensaje ?? '',\n                hora: a.ultimaHora ?? ''\n              }));\n            },\n            error: function () {\n              var _ref = _asyncToGenerator(function* (err) {\n                console.warn('No se pudo obtener alumnos por profesor, intentando cargar todos los alumnos', err);\n                // Fallback: cargar todos los alumnos registrados\n                _this.api.getAlumnos().pipe(take(1)).subscribe({\n                  next: all => {\n                    _this.alumnos = all.map(a => ({\n                      id: a.id,\n                      nombre: a.nombreCompleto ?? a.nombre ?? `${a.nombres} ${a.apellidos}`,\n                      mensaje: '',\n                      hora: ''\n                    }));\n                  },\n                  error: function () {\n                    var _ref2 = _asyncToGenerator(function* (err2) {\n                      console.error('No se pudo cargar lista de alumnos', err2);\n                      const t = yield _this.toastCtrl.create({\n                        message: 'No se pudo cargar la lista de alumnos.',\n                        duration: 2000\n                      });\n                      yield t.present();\n                      // Mantener lista vacía\n                    });\n                    return function error(_x2) {\n                      return _ref2.apply(this, arguments);\n                    };\n                  }()\n                });\n              });\n              return function error(_x) {\n                return _ref.apply(this, arguments);\n              };\n            }()\n          });\n        } else {\n          // Si no hay profesorId, dejar lista vacía y mostrar mensaje en UI\n          _this.alumnos = [];\n        }\n      })();\n    }\n    openConversation(alumno) {\n      // Navega a chat-room pasando el alumnoId; `chat-room` interpreta el id según rol\n      this.router.navigate(['/chat-room', alumno.id]);\n    }\n    // Cargar todos los alumnos registrados (para agregar a la lista del profesor)\n    mostrarTodos() {\n      var _this2 = this;\n      this.api.getAlumnos().pipe(take(1)).subscribe({\n        next: all => {\n          this.alumnos = all.map(a => ({\n            id: a.id,\n            nombre: a.nombreCompleto ?? a.nombre ?? `${a.nombres} ${a.apellidos}`,\n            mensaje: '',\n            hora: ''\n          }));\n        },\n        error: function () {\n          var _ref3 = _asyncToGenerator(function* (err) {\n            console.error('Error cargando todos los alumnos', err);\n            const t = yield _this2.toastCtrl.create({\n              message: 'No se pudo cargar los alumnos registrados.',\n              duration: 2000\n            });\n            yield t.present();\n          });\n          return function error(_x3) {\n            return _ref3.apply(this, arguments);\n          };\n        }()\n      });\n    }\n  }\n  TeacherChatPage.ɵfac = function TeacherChatPage_Factory(t) {\n    return new (t || TeacherChatPage)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.ToastController));\n  };\n  TeacherChatPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: TeacherChatPage,\n    selectors: [[\"app-teacher-chat\"]],\n    decls: 14,\n    vars: 1,\n    consts: [[1, \"ion-no-border\", \"teacher-header\"], [\"slot\", \"start\"], [\"defaultHref\", \"/teacher-home\"], [\"slot\", \"end\"], [\"color\", \"primary\", \"fill\", \"outline\", 3, \"click\"], [1, \"search-toolbar\"], [\"placeholder\", \"Buscar alumnos o mensajes\", \"showCancelButton\", \"never\"], [1, \"teacher-content\"], [\"lines\", \"none\"], [\"button\", \"\", \"class\", \"teacher-item\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"button\", \"\", 1, \"teacher-item\", 3, \"click\"], [\"slot\", \"start\", 1, \"teacher-avatar\"], [\"src\", \"assets/images/avatar-default.png\"], [1, \"teacher-label\"], [1, \"preview\"], [\"slot\", \"end\", 1, \"meta\"], [1, \"hora\"], [\"color\", \"danger\", \"class\", \"unread\", 4, \"ngIf\"], [\"color\", \"danger\", 1, \"unread\"]],\n    template: function TeacherChatPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\", 0)(1, \"ion-toolbar\")(2, \"ion-buttons\", 1);\n        i0.ɵɵelement(3, \"ion-back-button\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"ion-title\");\n        i0.ɵɵtext(5, \"Mensajes - Profesor\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"ion-buttons\", 3)(7, \"ion-button\", 4);\n        i0.ɵɵlistener(\"click\", function TeacherChatPage_Template_ion_button_click_7_listener() {\n          return ctx.mostrarTodos();\n        });\n        i0.ɵɵtext(8, \"Agregar\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(9, \"ion-toolbar\", 5);\n        i0.ɵɵelement(10, \"ion-searchbar\", 6);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(11, \"ion-content\", 7)(12, \"ion-list\", 8);\n        i0.ɵɵtemplate(13, TeacherChatPage_ion_item_13_Template, 12, 4, \"ion-item\", 9);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngForOf\", ctx.alumnos);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf, i3.IonAvatar, i3.IonBackButton, i3.IonBadge, i3.IonButton, i3.IonButtons, i3.IonContent, i3.IonHeader, i3.IonItem, i3.IonLabel, i3.IonList, i3.IonNote, i3.IonSearchbar, i3.IonTitle, i3.IonToolbar, i3.TextValueAccessor, i3.IonBackButtonDelegate],\n    styles: [\"[_nghost-%COMP%]{display:block;--bg: #f4f6fb;--card: #ffffff;--muted: #6b7280;--primary: #2563eb;--accent: #06b6d4}.teacher-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(90deg, #6b5bff 0%, #4f46e5 100%);color:#fff}.search-toolbar[_ngcontent-%COMP%]{--background: transparent;padding:6px 12px}.teacher-content[_ngcontent-%COMP%]{--background: var(--bg);padding:10px 14px}.teacher-item[_ngcontent-%COMP%]{--background: var(--card);border-radius:10px;margin-bottom:10px;box-shadow:0 6px 18px #1018280f;align-items:center}.teacher-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%}.teacher-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:15px;color:#111827}.teacher-label[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]{margin:4px 0 0;color:var(--muted);font-size:13px}.meta[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:6px}.meta[_ngcontent-%COMP%]   .hora[_ngcontent-%COMP%]{font-size:12px;color:var(--muted)}.meta[_ngcontent-%COMP%]   .unread[_ngcontent-%COMP%]{font-weight:600}.unread[_ngcontent-%COMP%]{min-width:22px;height:22px;display:inline-flex;align-items:center;justify-content:center;border-radius:12px}ion-searchbar[_ngcontent-%COMP%]{--background: #fff;border-radius:8px}\"]\n  });\n  return TeacherChatPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}